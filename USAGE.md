# EuroBlade — 使い方

## インストール

1. リポジトリをクローンまたはダウンロードします
2. 以下のファイルを MT5 の `MQL5/` フォルダにコピーします

| ファイル | コピー先 |
|---|---|
| `Experts/gridEA.mq5` | `MQL5/Experts/gridEA.mq5` |
| `Include/GridEA/GridDashboard.mqh` | `MQL5/Include/GridEA/GridDashboard.mqh` |
| `Include/GridEA/euroblade_icon.bmp` | `MQL5/Include/GridEA/euroblade_icon.bmp` |

3. MetaEditor で `gridEA.mq5` を開き、**F7** キーでコンパイルします
4. コンパイル成功後、MT5 のナビゲータに `gridEA` が表示されます
5. 任意のチャートにドラッグ&ドロップして起動します

## 入力パラメータ

### 基本設定

| パラメータ | デフォルト | 説明 |
|---|---|---|
| `UseAuthentication` | `false` | 口座認証の ON/OFF (`true` で WebRequest 認証を有効化) |
| `InitialLots` | `0.01` | 初期エントリーのロット数 |
| `GridWidthPips` | `5` | ナンピンする価格差 (pips) |
| `WaitMinutesAfterNanpin` | `10` | ナンピン間の最低待機時間 (分) |
| `TakeProfitPips` | `5` | 平均建値からの利益確定幅 (pips) |
| `TradeComment` | `"EuroBlade"` | 取引コメント |
| `MagicNumber` | `2025` | マジックナンバー (EA識別用) |

### 稼働時間

| パラメータ | デフォルト | 説明 |
|---|---|---|
| `TimeSource` | `PC_TIME` | 時間基準 (`BROKER_TIME` / `PC_TIME`) |
| `StartHour` | `0` | 稼働開始時刻 (時) |
| `EndHour` | `24` | 稼働終了時刻 (時)。`StartHour` と同じなら24時間稼働 |
| `ClosePositionsAtEndTime` | `false` | 稼働時間外に全ポジションを強制決済するか |

### トレーリングストップ

| パラメータ | デフォルト | 説明 |
|---|---|---|
| `TrailingStartCount` | `3` | トレーリングを開始するナンピン段数 |
| `UseBreakEvenTrail` | `true` | 損益分岐点到達後にトレーリングを開始 |
| `UseDirectTrail` | `false` | 平均建値+トリガーpipsで即トレーリング開始 |
| `TrailingTriggerPips` | `3` | トレーリング開始条件 (平均建値から+X pips) |
| `TrailingStepPips` | `2` | トレーリングのステップ幅 (pips) |

両方の `UseBreakEvenTrail` と `UseDirectTrail` を `true` にすることもできます（条件をどちらか満たせばトレーリング開始）。両方 `false` の場合、トレーリングは無効になります。

### MA トレンドフィルター

| パラメータ | デフォルト | 説明 |
|---|---|---|
| `UseMAFilter` | `false` | MA トレンドフィルターの ON/OFF |
| `MA_Period` | `21` | MA の計算期間 |
| `MA_Method` | `MODE_EMA` | MA の種別 (SMA / EMA / SMMA / LWMA) |
| `MA_UpperTF` | `PERIOD_H1` | 上位足のタイムフレーム |
| `MA_LowerTF` | `PERIOD_M5` | 下位足のタイムフレーム |
| `UseUpperTF` | `true` | 上位足の MA チェックを使用するか |
| `UseLowerTF` | `false` | 下位足の MA チェックを使用するか |

フィルターが ON の場合、MA の傾きがエントリー方向と一致しないときは**初期エントリーのみ禁止**されます。既にポジションがある場合のナンピンは継続します。

## ダッシュボード

チャート左上に自動表示されるダッシュボードには以下の情報が含まれます。

### セッション
Wellington / Tokyo / London / New York の4セッションの開閉状態を UTC 時間で判定し、`OPEN` / `closed` で表示します。

### ポジション状況
BUY / SELL それぞれのポジション数・保有ロット・損益をリアルタイム表示します（1分更新）。

### トレーリング / MA フィルター
- トレーリングSLが設定されている場合、その価格を表示
- MA トレンドの方向を矢印（↑ / ↓）で表示。フィルターが OFF の場合は `OFF` と表示

### 今週のサマリー
月曜から日曜の日別損益と DD (ドローダウン) をパーセントで表示します。総損益と利率も表示されます。

### 直近の大型指標
MT5 内蔵の経済カレンダーから高重要度（★★★）のイベントを最大5件表示します。残り時間は `〇日〇時間〇分後` の形式で、近づくにつれて7段階で色が変化します。

| 残り時間 | 色 |
|---|---|
| 1日以上 | 薄グレー |
| 12時間〜1日 | グレー |
| 3時間〜12時間 | ダークゴールド |
| 1時間〜3時間 | ダークオレンジ |
| 15分〜1時間 | ダークレッド |
| 3分〜15分 | レッド |
| 1分未満〜3分 | 鮮明レッド |

## 新規エントリーボタン

ダッシュボードのヘッダー右側に「新規: ON」ボタンがあります。

- **ON** (緑) — 通常通り新規エントリーを行います
- **OFF** (赤) — 新規の初期エントリーを停止します。ナンピンとTP決済は継続します

指標発表前にポジションを決済してからボタンを OFF にすると、EAは新しいポジションを取らなくなります。

## バックテスト

ストラテジーテスターでバックテストを実行すると、完了時にジャーナルに以下のサマリーが出力されます。

```
========================================
 EuroBlade バックテスト結果サマリー
========================================
 総取引回数 : 142 回
 合計ロット : 8.53 lot
 純損益     : +32,480 JPY
 利率       : +3.25 %
 最大DD     : 12,600 JPY
========================================
```

## 注意事項

- このEAはグリッドナンピン戦略を使用するため、相場が一方向に大きく動いた場合に大きなドローダウンが発生するリスクがあります
- 十分な証拠金を用意し、適切なロットサイズで運用してください
- バックテストで十分に検証してからライブ口座で使用することを推奨します
- 口座認証機能は `UseAuthentication = false` でデフォルト無効化されています
